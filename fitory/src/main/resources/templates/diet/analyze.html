<!DOCTYPE html>
<html layout:decorate="~{common}">
    <section layout:fragment="content">
        <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
        <h2>영양정보 분석</h2>
        <br>
        <h4>먹은 음식</h4>
        <input type="text" name="atefd" id="atefd" style="display: inline-block;">
        <input type="button" value="추가" onclick="af_ok()">
        <br>
        <br>
        <table id="atefd_title" style="width: 600px;">
            <tr>
                <th style="width: 200px;">음식명</th>
                <th style="width: 65px;">칼로리</th>
                <th style="width: 65px;">탄수화물</th>
                <th style="width: 65px;">단백질</th>
                <th style="width: 65px;">지방</th>
                <th style="width: 65px;">당류</th>
                <th>염분</th>
            </tr>
        </table>
        <table id="atefd_content" style="width: 600px; height: 400px;">

        </table>
        <table id="total" style="width: 600px;">
            <tr>
                <th style="width: 200px;">총성분</th>
                <th style="width: 65px;" id="tcal">0</th>
                <th style="width: 65px;" id="tcarbo">0</th>
                <th style="width: 65px;" id="tpro">0</th>
                <th style="width: 65px;" id="tfat">0</th>
                <th style="width: 65px;" id="tsugar">0</th>
                <th id="tsod">0</th>
            </tr>
        </table>
        <script>
            function af_ok(){
                let selectfd=$('#atefd').val();
                $.ajax({
                    url:'/diet/selectfood',
                    method:'get',
                    dataType:'json',
                    data:{
                        food_name:selectfd
                    },
                    success:function(data){
                        let sentence1='<tr>';
                        sentence1+='<td style="font-size: 13px; width: 170px;">'+data.food_name+'</td>';
                        sentence1+='<td style="font-size: 13px; width: 65px;">'+data.calories+'</td>';
                        sentence1+='<td style="font-size: 13px; width: 65px;">'+data.carbohydrate+'</td>';
                        sentence1+='<td style="font-size: 13px; width: 65px;">'+data.protein+'</td>';
                        sentence1+='<td style="font-size: 13px; width: 65px;">'+data.fat+'</td>';
                        sentence1+='<td style="font-size: 13px; width: 65px;">'+data.sugar+'</td>';
                        sentence1+='<td style="font-size: 13px; width: 65px;">'+data.sodium+'</td></tr>';
                        $('#atefd_content').append(sentence1);
                        let tcal=Number($("#tcal").html())+data.calories
                        $('#tcal').html(tcal);
                        let tcarbo=Number($("#tcarbo").html())+data.carbohydrate
                        $('#tcarbo').html(tcarbo.toFixed(2));
                        let tpro=Number($("#tpro").html())+data.protein
                        $('#tpro').html(tpro.toFixed(2));
                        let tfat=Number($("#tfat").html())+data.fat
                        $('#tfat').html(tfat.toFixed(2));
                        let tsugar=Number($("#tsugar").html())+data.sugar
                        $('#tsugar').html(tsugar.toFixed(2));
                        let tsod=Number($("#tsod").html())+data.sodium
                        $('#tsod').html(tsod.toFixed(2));
                    },
                    error:function(data){
                        alert('해당 데이터가 DB에 없음');
                    }
                })
            }
        </script>
    </section>
</html>
</html>